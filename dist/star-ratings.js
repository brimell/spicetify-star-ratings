!async function(){for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var u,r,p,a,f,c,m,d,y,b,g,i,n,S,v,h,o,w,l,s,t,k,E,x,P,N,A,e;u=Spicetify.React,r=Spicetify.React,p=[null,null,null,null,"[index] 16px [first] 4fr [var1] 2fr [var2] 1fr [last] minmax(120px,1fr)","[index] 16px [first] 6fr [var1] 4fr [var2] 3fr [var3] 2fr [last] minmax(120px,1fr)","[index] 16px [first] 6fr [var1] 4fr [var2] 3fr [var3] minmax(120px,2fr) [var3] 2fr [last] minmax(120px,1fr)"],a=()=>Spicetify.Player.data.item.uri,m={},d={},y={},v=[],x=E=k=t=s=l=w=o=S=n=i=g=b=c=f=null,A=N=P=!(h=[]),e=async function(){for(;!Spicetify?.showNotification;)await new Promise(e=>setTimeout(e,100));M(f=function(){var e={halfStarRatings:!0,likeThreshold:"4.0",enableKeyboardShortcuts:!0,showPlaylistStars:!0,nowPlayingStarsPosition:"left",skipThreshold:"disabled"};settings={};try{var t=JSON.parse(K("starRatings:settings"));if(!t||"object"!=typeof t)throw"";settings=t}catch{return L("starRatings:settings",e),e}let i=!1;for(const r of Object.keys(e))settings.hasOwnProperty(r)||(settings[r]=e[r],i=!0);return i&&L("starRatings:settings",settings),settings}()),await ce();const e={"5.0":Spicetify.Keyboard.KEYS.NUMPAD_0,.5:Spicetify.Keyboard.KEYS.NUMPAD_1,"1.0":Spicetify.Keyboard.KEYS.NUMPAD_2,1.5:Spicetify.Keyboard.KEYS.NUMPAD_3,"2.0":Spicetify.Keyboard.KEYS.NUMPAD_4,2.5:Spicetify.Keyboard.KEYS.NUMPAD_5,"3.0":Spicetify.Keyboard.KEYS.NUMPAD_6,3.5:Spicetify.Keyboard.KEYS.NUMPAD_7,"4.0":Spicetify.Keyboard.KEYS.NUMPAD_8,4.5:Spicetify.Keyboard.KEYS.NUMPAD_9},o=ee(e),l=(t=e,()=>{for(const e of Object.values(t))Spicetify.Keyboard._deregisterShortcut({key:e,ctrl:!0,alt:!0})});var t;const s=()=>{x&&x[0].remove(),w=null,ae(e)};new Spicetify.Menu.Item("Star Ratings",!0,()=>{var e,t,i,r,a,n;Spicetify.PopupModal.display({title:"Star Ratings",content:({settings:e,registerKeyboardShortcuts:t,deregisterKeyboardShortcuts:i,updateTracklist:r,restoreTracklist:a,redrawNowPlayingStars:n}=[{settings:f,registerKeyboardShortcuts:o,deregisterKeyboardShortcuts:l,updateTracklist:re,restoreTracklist:ie,redrawNowPlayingStars:s}][0],u.createElement("div",null,u.createElement(z,{value:"Settings"}),u.createElement(Y,{settings:e,name:"Half star ratings",field:"halfStarRatings"}),u.createElement(Y,{settings:e,name:"Enable keyboard shortcuts",field:"enableKeyboardShortcuts",onclick:function(){(e.enableKeyboardShortcuts?t:i)()}}),u.createElement(Y,{settings:e,name:"Show playlist stars",field:"showPlaylistStars",onclick:function(){(e.showPlaylistStars?r:a)()}}),u.createElement(F,{settings:e,name:"Auto-like/dislike threshold",field:"likeThreshold",options:{Disabled:"disabled","3.0":"3.0",3.5:"3.5","4.0":"4.0",4.5:"4.5","5.0":"5.0"}}),u.createElement(F,{settings:e,name:"Now playing stars position",field:"nowPlayingStarsPosition",options:{Left:"left",Right:"right"},onclick:function(){n()}}),u.createElement(F,{settings:e,name:"Skip threshold",field:"skipThreshold",options:{Disabled:"disabled","0.0":"0.0",.5:"0.5","1.0":"1.0",1.5:"1.5","2.0":"2.0",2.5:"2.5","3.0":"3.0",3.5:"3.5","4.0":"4.0",4.5:"4.5"}}),u.createElement(z,{value:"Keyboard Shortcuts"}),u.createElement("ul",null,u.createElement(U,{label:"Rate current track 0.5 stars",numberKey:"1"}),u.createElement(U,{label:"Rate current track 1 star",numberKey:"2"}),u.createElement(U,{label:"Rate current track 1.5 stars",numberKey:"3"}),u.createElement(U,{label:"Rate current track 2 stars",numberKey:"4"}),u.createElement(U,{label:"Rate current track 2.5 stars",numberKey:"5"}),u.createElement(U,{label:"Rate current track 3 stars",numberKey:"6"}),u.createElement(U,{label:"Rate current track 3.5 stars",numberKey:"7"}),u.createElement(U,{label:"Rate current track 4 stars",numberKey:"8"}),u.createElement(U,{label:"Rate current track 4.5 stars",numberKey:"9"}),u.createElement(U,{label:"Rate current track 5 stars",numberKey:"0"})))),isLarge:!0})}).register(),S=new MutationObserver(()=>{re()}),Spicetify.Player.addEventListener("songchange",()=>{var e=Spicetify.Player.data.item.uri;e in m&&"disabled"!==f.skipThreshold&&m[e]<=parseFloat(f.skipThreshold)?Spicetify.Player.next():oe()}),Spicetify.Platform.History.listen(async()=>{await ne()}),new Spicetify.ContextMenu.Item("Use as Rated folder",e=>{_(c=e[0]),N=!0,ce().finally(()=>{N=!1})},le).register(),new Spicetify.ContextMenu.Item("Sort by rating",e=>{var t,i;Spicetify.PopupModal.display({title:"Modify Custom order?",content:({onClickCancel:t,onClickOK:i}=[{onClickCancel:()=>{Spicetify.PopupModal.hide()},onClickOK:()=>{Spicetify.PopupModal.hide(),A=!0,R("Sorting..."),V(e[0],m).finally(()=>{A=!1})}}][0],r.createElement("div",{className:"parent-div"},r.createElement("p",null,"This will modify the ",r.createElement("b",null,"Custom order")," of the playlist."),r.createElement("div",{className:"button-div"},r.createElement(G,{name:"Cancel",className:"cancel-button",onButtonClick:t}),r.createElement(G,{name:"Sort",className:"ok-button",onButtonClick:i}))))})},se).register();var i=new MutationObserver(async()=>{await ae(e)});await ae(e),i.observe(document.body,{childList:!0,subtree:!0})},(async()=>{await e()})();function R(e){Spicetify.showNotification(e)}function K(e){return Spicetify.LocalStorage.get(e)}function L(e,t){Spicetify.LocalStorage.set(e,t)}async function C(){return Spicetify.Platform.RootlistAPI.getContents()}async function O(e,t){await Spicetify.Platform.PlaylistAPI.remove(e,[{uri:t,uid:""}])}async function B(e){return(await Spicetify.CosmosAsync.get("sp://core-playlist/v1/playlist/"+e)).items}async function j(e){return 1===(await Spicetify.CosmosAsync.get("sp://desktop/v1/version")).version.localeCompare(e,void 0,{numeric:!0,sensitivity:"base"})}function I(e,t){var i,r,a,n=document.createElement("span"),o="stars-"+e,l=(n.className="stars",n.id=o,n.style.whiteSpace="nowrap",n.style.alignItems="center",n.style.display="flex",[]);for(let e=0;e<5;e++){u=o,i=e+1,c=t,a=r=s=void 0,s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg"),u=u+"-"+i,r.id=u,r.style.minHeight=c+"px",r.style.minWidth=c+"px",r.setAttributeNS(null,"width",c+"px"),r.setAttributeNS(null,"height",c+"px"),r.setAttributeNS(null,"viewBox","0 0 32 32"),i=document.createElementNS(s,"defs"),r.append(i),c=document.createElementNS(s,"linearGradient"),i.append(c),c.id=u+"-gradient",i=document.createElementNS(s,"stop"),c.append(i),i.id=u+"-gradient-first",i.setAttributeNS(null,"offset","50%"),i.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),a=document.createElementNS(s,"stop"),c.append(a),a.id=u+"-gradient-second",a.setAttributeNS(null,"offset","50%"),a.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),u=document.createElementNS(s,"path"),r.append(u),u.setAttributeNS(null,"fill",`url(#${c.id})`),u.setAttributeNS(null,"d","M20.388,10.918L32,12.118l-8.735,7.749L25.914,31.4l-9.893-6.088L6.127,31.4l2.695-11.533L0,12.118l11.547-1.2L16.026,0.6L20.388,10.918z");var[s,c,u]=[r,i,a];n.append(s),l.push([s,c,u])}return[n,l]}function T(t,e){var i=e/=.5;for(let e=0;e<5;e++){var r=t[e][1],a=t[e][2];r.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),a.setAttributeNS(null,"stop-color","var(--spice-button-disabled)")}for(let e=0;e<i;e++){var n=Math.floor(e/2),o=t[n][1],n=t[n][2];(e%2==0?o:n).setAttributeNS(null,"stop-color","var(--spice-button)")}}function D(e,t,i){t=t.getBoundingClientRect(),t=event.clientX-t.left;let r=i+1;return 8<t||!e.halfStarRatings||(r-=.5),0===i&&t<3&&(r-=e.halfStarRatings?.5:1),r}function M(e){L("starRatings:settings",JSON.stringify(e))}function q(e){L("starRatings:playlistUris",JSON.stringify(e))}function _(e){L("starRatings:ratedFolderUri",e)}function H(){return u.createElement("svg",{width:16,height:16,viewbox:"0 0 16 16",fill:"currentColor",dangerouslySetInnerHTML:{__html:Spicetify.SVGIcons.check}})}function Y({settings:t,name:e,field:i,onclick:r}){let[a,n]=Spicetify.React.useState(t[i]);var o=a?"checkbox":"checkbox disabled";return u.createElement("div",{className:"popup-row"},u.createElement("label",{className:"col description"},e),u.createElement("div",{className:"col action"},u.createElement("button",{className:o,onClick:function(){var e=!a;t[i]=e,n(e),M(t),r&&r()}},u.createElement(H,null))))}function F({settings:t,name:e,field:i,options:r,onclick:a}){const[n,o]=Spicetify.React.useState(t[i]);var l,s,c=[];for([l,s]of Object.entries(r))c.push(u.createElement("option",{value:s},l));return u.createElement("div",{className:"popup-row"},u.createElement("label",{className:"col description"},e),u.createElement("div",{className:"col action"},u.createElement("select",{value:n,onChange:function(e){o(e.target.value),t[i]=e.target.value,M(t),a&&a()}},c)))}function U({label:e,numberKey:t}){return u.createElement("li",{className:"main-keyboardShortcutsHelpModal-sectionItem"},u.createElement("span",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-sectionItemName"},e),u.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},"Ctrl"),u.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},"Alt"),u.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},t))}function z({value:e}){return u.createElement("h2",{className:"Type__TypeElement-goli3j-0 bcTfIx main-keyboardShortcutsHelpModal-sectionHeading"},e)}function G({name:e,className:t,onButtonClick:i}){return r.createElement("button",{className:t,onClick:i},e)}function J(e,t){return e.items.find(e=>"folder"===e.type&&e.name===t)}async function V(i,r){const a=["5.0","4.5","4.0","3.5","3.0","2.5","2.0","1.5","1.0","0.5","0.0"];var n=await B(i);if(0!==n.length){var o={};for(const p of a)o[p]=[];for(const f of n){let e=r[f.link]??0;o[e="number"==typeof e?e.toFixed(1):e].push(f.rowId)}let e=function(e){for(const t of a)if(0<e[t].length)return e[t][0];return null}(o);var l,s,c,u,n=n[0].rowId,d=e===n;let t=!0;for(const m of a)0!==o[m].length&&(!d&&t?(l=i,s=o[m],c=e,u=void 0,u=await j("1.2.5.1006.g22820f93"),await Spicetify.Platform.PlaylistAPI.move(l,s.map(e=>({uid:e})),{before:u?{uid:c}:c})):(l=i,s=o[m],u=e,c=void 0,c=await j("1.2.5.1006.g22820f93"),await Spicetify.Platform.PlaylistAPI.move(l,s.map(e=>({uid:e})),{after:c?{uid:u}:u})),t=!1,e=o[m].slice(-1)[0])}}function W(){var e=Spicetify.Platform.History.location.pathname.match(/album\/(.*)/);return e?e[1]:null}function $(e){return e.replace("spotify:track:","")}function X(){var e=function(e,t){if(console.log("album is:",t),!t)return"0.0";let i=0,r=0;for(const o of t.tracks.items){var a=o.uri,a=parseFloat(e[a]);a&&(i+=a,r+=1)}let n=0;return 0<r&&(n=i/r),(n=Math.round(2*n)/2).toFixed(1)}(m,k);T(E[1],e)}async function Q(e,t,i){var r,a,n;m[e]=i,t&&await O(y[t],e),c||(await Spicetify.Platform.RootlistAPI.createFolder("Rated",{before:""}),a=J(await C(),"Rated"),_(c=a.uri));let o=y[i];o||(o=(a=i,n=c,n=navigator.platform.startsWith("Linux")&&navigator.userAgent.includes("Spotify/1.1.84.716")?{after:n}:{after:{uri:n}},await Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/users/${Spicetify.User.getUsername()}/playlists`,{name:a,...n})),r=o,await!setTimeout(async()=>{await Spicetify.CosmosAsync.post(`sp://core-playlist/v1/playlist/${r}/set-base-permission`,{permission_level:"BLOCKED"})},1e3),y[i]=o,q(y),d[o]=i),n=o,await Spicetify.Platform.PlaylistAPI.add(n,[e],{after:1,before:0}),R((t?"Moved":"Added")+" to "+d[o])}function Z(o,l,s,c){return()=>{if(!(P||N||A)){P=!0;var[,r]=s,r=r[o][0];const a=c(),n=m[a];let t=null!==l?l:D(f,r,o).toFixed(1),e=null,i=null;n===t?(i=0,e=async function(e,t){delete m[e];var t=y[t],i=d[t];await O(t,e),R("Removed from "+i)}(a,t)):(i=t,e=Q(a,n,t),"disabled"!==f.likeThreshold&&t>=parseFloat(f.likeThreshold)&&async function(e){(await Spicetify.Platform.LibraryAPI.contains(e))[0]||await Spicetify.Platform.LibraryAPI.add({uris:[e],silent:0})}(a)),e.finally(()=>{var e=function(e){var t="stars-"+e;if(!(e=document.getElementById(t)))return null;var i=[];for(let e=1;e<=5;e++){var r=t+"-"+e,a=document.getElementById(r),n=document.getElementById(r+"-gradient-first"),r=document.getElementById(r+"-gradient-second");i.push([a,n,r])}return[e,i]}($(a));e&&(T(e[1],i),e[0].style.visibility=n===t?"hidden":"visible"),oe(),P=!1})}}}function ee(i){return()=>{for(var[e,t]of Object.entries(i))Spicetify.Keyboard.registerShortcut({key:t,ctrl:!0,alt:!0},Z(0,parseFloat(e),x,a))}}function te(e,i){const[t,r]=e;t.addEventListener("mouseout",function(){var e;T(r,(e=i(),m[e]??0))});for(let t=0;t<5;t++){const a=r[t][0];a.addEventListener("mousemove",function(){var e=D(f,a,t);T(r,e)}),a.addEventListener("click",Z(t,null,e,i))}}function ie(){document.querySelectorAll(".main-trackList-trackListHeaderRow").forEach(e=>{e.style["grid-template-columns"]=b});for(const r of Array.from(v)){var e=r.getElementsByClassName("main-trackList-trackListRow");for(const a of Array.from(e)){var t,i=a.querySelector(".starRatings");i&&(a.style["grid-template-columns"]=g,i.remove(),i=a.querySelector(".main-trackList-rowSectionEnd"),t=parseInt(i.getAttribute("aria-colindex")),i.setAttribute("aria-colindex",(t-1).toString()))}}}function re(){if(f.showPlaylistStars){h=v;let t=(v=Array.from(document.querySelectorAll(".main-trackList-indexable"))).length!==h.length;for(let e=0;e<v.length;e++)v[e].isEqualNode(h[e])||(t=!0);t&&(g=b=null);{var e=v;let i=null;var r=document.querySelectorAll(".main-trackList-trackListHeaderRow");r.forEach(e=>{var t=e.querySelector(".main-trackList-rowSectionEnd"),t=parseInt(t.getAttribute("aria-colindex"));(b=b||getComputedStyle(e).gridTemplateColumns)&&p[t]&&(e.style["grid-template-columns"]=p[t],i=p[t])});for(const s of e)for(const c of s.getElementsByClassName("main-trackList-trackListRow")){var a=0<c.getElementsByClassName("stars").length;const u=function(e){return(e=Object.values(e))?(e=e[0]?.pendingProps?.children[0]?.props?.children)?.props?.uri||e?.props?.children?.props?.uri||e?.props?.children?.props?.children?.props?.uri||e[0]?.props?.uri:null}(c);var n=u.includes("track");let e=c.querySelector(".starRatings");if(e||(o=c.querySelector(".main-trackList-rowSectionEnd"),l=parseInt(o.getAttribute("aria-colindex")),o.setAttribute("aria-colindex",(l+1).toString()),(e=document.createElement("div")).setAttribute("aria-colindex",l.toString()),e.role="gridcell",e.style.display="flex",e.classList.add("main-trackList-rowSectionVariable"),e.classList.add("starRatings"),c.insertBefore(e,o),g=g||getComputedStyle(c).gridTemplateColumns,p[l]&&(c.style["grid-template-columns"]=i||p[l])),u&&!a&&n){var o=I($(u),16);const d=o[0];var l=o[1],a=m[u]??0;e.appendChild(d),T(l,a),te(o,()=>u),d.style.visibility=void 0!==m[u]?"visible":"hidden",c.addEventListener("mouseover",()=>{d.style.visibility="visible"}),c.addEventListener("mouseout",()=>{d.style.visibility=void 0!==m[u]?"visible":"hidden"})}}}}}async function ae(e){i=n,(n=document.querySelector("main"))&&!n.isEqualNode(i)&&(i&&S.disconnect(),re(),S.observe(n,{childList:!0,subtree:!0})),o=w;var t="left"===f.nowPlayingStarsPosition?".main-nowPlayingWidget-nowPlaying .main-trackInfo-container":".main-nowPlayingBar-right div";(w=document.querySelector(t))&&!w.isEqualNode(o)&&((x=I("now-playing",16))[0].style.marginLeft="8px",x[0].style.marginRight="8px","left"===f.nowPlayingStarsPosition?w.after(x[0]):w.prepend(x[0]),te(x,a),oe(),f.enableKeyboardShortcuts)&&ee(e)(),l=s,(s=document.querySelector(".main-actionBar-ActionBar .ix_8kg3iUb9VS5SmTnBY"))&&!s.isEqualNode(l)&&null!==W()&&(E=I("album",32),s.after(E[0]),await ne())}async function ne(){var e;E&&(t=W(),E[0].style.display=t?"flex":"none",console.log("albumId is:",t),t)&&(e=t,k=await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/albums/"+e,{offset:0,limit:450}),X())}function oe(){var e,t;x&&(t=(e=Spicetify.Player.data.item.uri).includes("track"),x[0].style.display=t?"flex":"none",t=m[e]??0,T(x[1],t))}function le(e){return Spicetify.URI.fromString(e[0]).type===Spicetify.URI.Type.FOLDER}function se(e){switch(Spicetify.URI.fromString(e[0]).type){case Spicetify.URI.Type.PLAYLIST:case Spicetify.URI.Type.PLAYLIST_V2:return!0}return!1}async function ce(){c=K("starRatings:ratedFolderUri"),m={},d={},y=function(){try{var e=JSON.parse(K("starRatings:playlistUris"));if(e&&"object"==typeof e)return e;throw""}catch{return L("starRatings:playlistUris","{}"),{}}}();let e=null;var t,i,r,a;c?(t=await C(),e=(i=c,t.items.find(e=>"folder"===e.type&&e.uri===i))):(t=await C(),(e=J(t,"Rated"))&&_(c=e.uri)),e?(r=!1,[r,y]=function(e,t){var i={};let r=!1;for(const[a,n]of Object.entries(e))t.items.find(e=>e.uri===n)?i[a]=n:r=!0;return[r,i]}(y,e),a=!1,[a,y]=function(t,e){const i={...t};let r=!1;const a=["0.0","0.5","1.0","1.5","2.0","2.5","3.0","3.5","4.0","4.5","5.0"].filter(e=>!t.hasOwnProperty(e));return e.items.filter(e=>a.includes(e.name)).forEach(e=>{i[e.name]=e.uri,r=!0}),[r,i]}(y,e),(a||r)&&q(y),a=await async function(t){var i=Object.keys(t),r=await Promise.all(i.map(e=>B(t[e]))),a={};for(let e=0;e<i.length;e++)a[i[e]]=r[e];return a}(y),m=function(e){var t,i,r={};for([t,i]of Object.entries(e))for(const a of i)r[a.link]=t;return r}(a),d=function(t,e){const i={};return e.items.filter(e=>Object.values(t).includes(e.uri)).forEach(e=>{i[e.uri]=e.name}),i}(y,e)):0<Object.keys(y).length&&(q(y={}),_(c=""))}(async()=>{var e;document.getElementById("starDratings")||((e=document.createElement("style")).id="starDratings",e.textContent=String.raw`
  .popup-row::after{content:"";display:table;clear:both}.popup-row .col{display:flex;padding:10px 0;align-items:center}.popup-row .col.description{float:left;padding-right:15px}.popup-row .col.action{float:right;text-align:right}.popup-row .div-title{color:var(--spice-text)}.popup-row .divider{height:2px;border-width:0;background-color:var(--spice-button-disabled)}.popup-row .space{margin-bottom:20px;visibility:hidden}button.checkbox{align-items:center;border:0;border-radius:50%;background-color:rgba(var(--spice-rgb-shadow),.7);color:var(--spice-text);cursor:pointer;display:flex;margin-inline-start:12px;padding:8px}button.checkbox.disabled{color:rgba(var(--spice-rgb-text),.3)}select{color:var(--spice-text);background:rgba(var(--spice-rgb-shadow),.7);border:0;height:32px}::-webkit-scrollbar{width:8px}.login-button{background-color:var(--spice-button);border-radius:8px;border-style:none;box-sizing:border-box;color:var(--spice-text);cursor:pointer;display:inline-block;font-size:14px;font-weight:500;height:40px;line-height:20px;list-style:none;margin:10px;outline:0;padding:5px 10px;position:relative;text-align:center;text-decoration:none;vertical-align:baseline;touch-action:manipulation}.parent-div{display:flex;flex-direction:column;gap:8px}.button-div{margin-top:24px;display:flex;gap:16px;justify-content:flex-end}.cancel-button{background-color:transparent;font-weight:700;border:0;color:var(--spice-text);display:inline-flex;border-radius:500px;font-size:inherit;min-block-size:48px;align-items:center;padding-inline:32px}.cancel-button:hover{transform:scale(1.04)}.ok-button{background-color:var(--spice-button-active);font-weight:700;border:0;color:var(--spice-main);display:inline-flex;border-radius:500px;font-size:inherit;min-block-size:48px;align-items:center;padding-inline:32px}.ok-button:hover{transform:scale(1.04)}
      `.trim(),document.head.appendChild(e))})()}();